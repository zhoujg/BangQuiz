# 学习单元题目关联修复说明

## 问题描述
之前所有学习单元的"开始学习"练习题都是一样的，因为题目没有正确关联到各自的学习单元。

## 问题原因
1. 数据库中所有题目的 `learning_outcome_id` 字段都是 `NULL`
2. 所有示例题目的 `knowledge_point` 都是 "Unit 1 - Concepts"
3. `getUnitQuestions()` 方法使用 `exam_package_id` 查询，导致返回所有题目

## 解决方案

### 1. 创建数据迁移
创建了 `2026_01_30_152434_link_questions_to_learning_outcomes.php` 迁移文件：
- 根据题目的 `knowledge_point` 字段（如 "Unit 1 - Concepts"）自动关联到对应学习单元的学习成果
- 将题目的 `learning_outcome_id` 字段设置为对应单元的第一个学习成果ID

### 2. 更新控制器方法
修改 `ExamController.php` 的 `getUnitQuestions()` 方法：
```php
// 之前：根据 exam_package_id 查询（返回所有题目）
$questions = Question::whereHas('exam', function($query) use ($unit) {
    $query->where('exam_package_id', $unit->exam_package_id);
})->get();

// 现在：根据 learning_outcome_id 查询（只返回该单元的题目）
$outcomeIds = $unit->learningOutcomes->pluck('id');
$questions = Question::whereIn('learning_outcome_id', $outcomeIds)->get();
```

### 3. 添加更多题目
创建了 `AdditionalQuestionsSeeder.php` 为其他学习单元添加专属题目：
- **Unit 2 (ADM Overview)**: 3道题目
  - ADM 的核心是什么？
  - ADM 包含多少个阶段？
  - ADM 的预备阶段主要做什么？

- **Unit 3 (Architecture Vision)**: 3道题目
  - 架构愿景阶段的主要输出是什么？
  - 利益相关者管理在哪个阶段最为重要？
  - 架构工作说明书（SOW）在哪个阶段创建？

- **Unit 4 (Business Architecture)**: 3道题目
  - 业务架构阶段的主要关注点是什么？
  - 业务能力映射的主要目的是什么？
  - 价值流图在业务架构中的作用是什么？

## 当前状态

### 题目分布
- **Unit 1 (Concepts)**: 15道题目
- **Unit 2 (ADM Overview)**: 3道题目
- **Unit 3 (Architecture Vision)**: 3道题目
- **Unit 4 (Business Architecture)**: 3道题目
- **Unit 5-10**: 暂无题目（可以后续添加）

### API 测试结果
```bash
# Unit 1
GET /api/learning-units/1/questions
返回: 15道题目

# Unit 2
GET /api/learning-units/2/questions
返回: 3道题目

# Unit 3
GET /api/learning-units/3/questions
返回: 3道题目

# Unit 4
GET /api/learning-units/4/questions
返回: 3道题目
```

## 如何为其他单元添加题目

### 方法1: 使用 Seeder（推荐）
1. 编辑 `backend/database/seeders/AdditionalQuestionsSeeder.php`
2. 参考现有代码添加新单元的题目
3. 运行: `php artisan db:seed --class=AdditionalQuestionsSeeder`

### 方法2: 直接插入数据库
```sql
INSERT INTO questions (
    exam_id, 
    learning_outcome_id, 
    content, 
    options, 
    correct_answer, 
    explanation, 
    knowledge_point, 
    difficulty, 
    sort_order
) VALUES (
    1,  -- exam_id
    (SELECT id FROM learning_outcomes WHERE learning_unit_id = 5 LIMIT 1),  -- Unit 5的第一个学习成果
    '题目内容',
    '{"A":"选项A","B":"选项B","C":"选项C","D":"选项D"}',
    'A',
    '答案解释',
    'Unit 5 - 知识点',
    'easy',
    500
);
```

## 数据模型关系
```
ExamPackage (测验包)
  └── LearningUnit (学习单元)
        └── LearningOutcome (学习成果)
              └── Question (题目)
```

## 相关文件
- `backend/app/Http/Controllers/Api/ExamController.php` - API控制器
- `backend/app/Models/Question.php` - 题目模型
- `backend/app/Models/LearningOutcome.php` - 学习成果模型
- `backend/database/migrations/2026_01_30_152434_link_questions_to_learning_outcomes.php` - 关联迁移
- `backend/database/seeders/AdditionalQuestionsSeeder.php` - 题目种子数据

## 验证方法
在前端测试：
1. 访问 http://localhost:8100
2. 进入"学习路径"
3. 点击不同学习单元的"开始学习"
4. 确认每个单元显示不同的题目

## 注意事项
1. 题目的 `knowledge_point` 字段应该包含 "Unit X" 格式，便于识别所属单元
2. 每个题目必须关联到一个 `learning_outcome_id`
3. 如果某个单元没有题目，API 会返回空数组 `[]`
4. 建议每个单元至少有5-10道题目，以提供良好的学习体验
