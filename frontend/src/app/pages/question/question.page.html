<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/learning-path"></ion-back-button>
    </ion-buttons>
    <ion-title>åˆ·é¢˜ç»ƒä¹ </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="exitPractice()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  
  <!-- è¿›åº¦æ¡ -->
  <ion-toolbar *ngIf="totalQuestions > 0">
    <ion-progress-bar [value]="currentQuestionIndex / totalQuestions"></ion-progress-bar>
    <ion-text class="ion-padding-horizontal">
      <small>ç¬¬ {{ currentQuestionIndex + 1 }} / {{ totalQuestions }} é¢˜</small>
    </ion-text>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- å®Œæˆæç¤º -->
  <ion-card *ngIf="isCompleted">
    <ion-card-header>
      <ion-card-title>ğŸ‰ ç»ƒä¹ å®Œæˆï¼</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>ä½ å·²ç»å®Œæˆäº†æœ¬å•å…ƒçš„æ‰€æœ‰é¢˜ç›®ç»ƒä¹ ã€‚</p>
      <p>æ­£ç¡®ç‡ï¼š{{ correctCount }} / {{ totalQuestions }} ({{ (correctCount / totalQuestions * 100).toFixed(0) }}%)</p>
      
      <ion-button expand="block" (click)="restartPractice()">
        é‡æ–°ç»ƒä¹ 
      </ion-button>
      <ion-button expand="block" fill="outline" routerLink="/learning-path">
        è¿”å›å­¦ä¹ è·¯å¾„
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="question && !isCompleted">
    <!-- é¢˜ç›®åœºæ™¯ -->
    <ion-card-header *ngIf="question.scenario">
      <ion-card-subtitle>åœºæ™¯æ¡ˆä¾‹</ion-card-subtitle>
      <ion-text color="medium">
        <p>{{ question.scenario }}</p>
      </ion-text>
    </ion-card-header>

    <!-- é¢˜ç›®å†…å®¹ -->
    <ion-card-content>
      <h2>{{ question.content }}</h2>
      
      <!-- é€‰é¡¹ -->
      <ion-radio-group [(ngModel)]="selectedAnswer" [disabled]="showResult">
        <ion-item *ngFor="let option of question.options | keyvalue">
          <ion-radio slot="start" [value]="option.key" labelPlacement="end" class="ion-text-wrap">
            <strong>{{ option.key }}.</strong> {{ option.value }}
          </ion-radio>
        </ion-item>
      </ion-radio-group>

      <!-- ç»“æœæ˜¾ç¤º -->
      <div *ngIf="showResult" class="result-section">
        <ion-chip [color]="isCorrect ? 'success' : 'danger'">
          <ion-label>{{ isCorrect ? 'âœ“ å›ç­”æ­£ç¡®' : 'âœ— å›ç­”é”™è¯¯' }}</ion-label>
        </ion-chip>
        
        <ion-card color="light">
          <ion-card-header>
            <ion-card-subtitle>è¯¦ç»†è§£æ</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            {{ explanation }}
          </ion-card-content>
        </ion-card>
      </div>

      <!-- æŒ‰é’® -->
      <div class="button-group">
        <ion-button 
          *ngIf="!showResult" 
          expand="block" 
          (click)="submitAnswer()"
          [disabled]="!selectedAnswer">
          æäº¤ç­”æ¡ˆ
        </ion-button>
        
        <ion-button 
          *ngIf="showResult" 
          expand="block" 
          (click)="nextQuestion()">
          ä¸‹ä¸€é¢˜
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- çŸ¥è¯†ç‚¹æ ‡ç­¾ -->
  <ion-chip *ngIf="question" color="primary">
    <ion-label>{{ question.knowledge_point }}</ion-label>
  </ion-chip>
  <ion-chip *ngIf="question" [color]="question.difficulty === 'easy' ? 'success' : question.difficulty === 'medium' ? 'warning' : 'danger'">
    <ion-label>{{ question.difficulty === 'easy' ? 'ç®€å•' : question.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾' }}</ion-label>
  </ion-chip>
</ion-content>
